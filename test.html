<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIFF æ¸¬è©¦</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .log { 
            background: white; 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .error { border-left-color: #e74c3c; }
        .success { border-left-color: #27ae60; }
        pre { 
            background: #2c3e50; 
            color: #ecf0f1; 
            padding: 10px; 
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ” LIFF åˆå§‹åŒ–æ¸¬è©¦</h1>
    <div id="logs"></div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        const LIFF_ID = '2008947743-8h9hmMMW';
        const logs = document.getElementById('logs');

        function addLog(message, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong><br>${message}`;
            logs.appendChild(div);
            console.log(message);
        }

        async function testLIFF() {
            addLog('ğŸ”§ é–‹å§‹æ¸¬è©¦ LIFF...', 'log');
            addLog(`ğŸ“± LIFF ID: ${LIFF_ID}`, 'log');
            addLog(`ğŸŒ ç•¶å‰ç¶²å€: ${window.location.href}`, 'log');

            try {
                // æ¸¬è©¦ 1: æª¢æŸ¥ LIFF SDK æ˜¯å¦è¼‰å…¥
                if (typeof liff === 'undefined') {
                    throw new Error('LIFF SDK æœªè¼‰å…¥');
                }
                addLog('âœ… LIFF SDK å·²è¼‰å…¥', 'success');

                // æ¸¬è©¦ 2: åˆå§‹åŒ– LIFF
                addLog('â³ æ­£åœ¨åˆå§‹åŒ– LIFF...', 'log');
                await liff.init({ liffId: LIFF_ID });
                addLog('âœ… LIFF åˆå§‹åŒ–æˆåŠŸï¼', 'success');

                // æ¸¬è©¦ 3: æª¢æŸ¥ç’°å¢ƒ
                const isInClient = liff.isInClient();
                addLog(`ğŸ“ åŸ·è¡Œç’°å¢ƒ: ${isInClient ? 'LINE App å…§' : 'å¤–éƒ¨ç€è¦½å™¨'}`, 'log');

                // æ¸¬è©¦ 4: æª¢æŸ¥ç™»å…¥ç‹€æ…‹
                const isLoggedIn = liff.isLoggedIn();
                addLog(`ğŸ” ç™»å…¥ç‹€æ…‹: ${isLoggedIn ? 'å·²ç™»å…¥' : 'æœªç™»å…¥'}`, 'log');

                if (isLoggedIn) {
                    // æ¸¬è©¦ 5: å–å¾—ä½¿ç”¨è€…è³‡æ–™
                    const profile = await liff.getProfile();
                    addLog('âœ… ä½¿ç”¨è€…è³‡æ–™:', 'success');
                    addLog(`<pre>${JSON.stringify({
                        userId: profile.userId,
                        displayName: profile.displayName,
                        pictureUrl: profile.pictureUrl,
                        statusMessage: profile.statusMessage
                    }, null, 2)}</pre>`, 'success');
                } else {
                    addLog('âš ï¸ æœªç™»å…¥ï¼Œ3ç§’å¾Œå°‡è·³è½‰è‡³ç™»å…¥é é¢...', 'log');
                    setTimeout(() => {
                        liff.login();
                    }, 3000);
                }

            } catch (error) {
                addLog('âŒ LIFF åˆå§‹åŒ–å¤±æ•—', 'error');
                addLog(`<strong>éŒ¯èª¤åç¨±:</strong> ${error.name}`, 'error');
                addLog(`<strong>éŒ¯èª¤è¨Šæ¯:</strong> ${error.message}`, 'error');
                addLog(`<pre>${JSON.stringify(error, Object.getOwnPropertyNames(error), 2)}</pre>`, 'error');

                // å¸¸è¦‹éŒ¯èª¤åˆ¤æ–·
                if (error.message.includes('400')) {
                    addLog('ğŸ’¡ å¯èƒ½åŸå› ï¼šLIFF ID éŒ¯èª¤æˆ–ä¸å­˜åœ¨', 'error');
                    addLog('è«‹åˆ° LINE Developers Console ç¢ºèª LIFF ID', 'error');
                } else if (error.message.includes('403')) {
                    addLog('ğŸ’¡ å¯èƒ½åŸå› ï¼šEndpoint URL è¨­å®šéŒ¯èª¤', 'error');
                    addLog(`è«‹ç¢ºèª LIFF Endpoint URL æ˜¯å¦ç‚º: ${window.location.origin + window.location.pathname}`, 'error');
                } else if (error.message.includes('liffId')) {
                    addLog('ğŸ’¡ å¯èƒ½åŸå› ï¼šLIFF ID æ ¼å¼éŒ¯èª¤', 'error');
                }
            }
        }

        // å•Ÿå‹•æ¸¬è©¦
        window.addEventListener('load', () => {
            addLog('ğŸ“„ é é¢å·²è¼‰å…¥', 'log');
            setTimeout(testLIFF, 500);
        });
    </script>
</body>
</html>
