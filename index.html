<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ormkub 會員專區</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- 基礎設定 --- */
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8f9fa; /* 安全的淺灰底色 */
            color: #333;
            min-height: 100vh;
            padding-bottom: 50px;
        }

        .hidden { display: none !important; }

        /* --- Loading 遮罩 (改為純 CSS，不依賴圖片) --- */
        #loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: #ffffff;
            z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .loading-spinner {
            width: 3rem; height: 3rem; border-width: 0.25em;
        }
        .loading-text {
            margin-top: 15px; font-weight: 500; letter-spacing: 2px; color: #555;
        }

        /* --- 品牌 Logo (處理圖片破圖的狀況) --- */
        .brand-logo {
            max-width: 160px; height: auto; display: block; margin: 0 auto 20px;
            background: #f0f0f0; /* 圖片載入失敗時的底色 */
            border-radius: 8px;
            min-height: 50px;
        }

        /* --- 卡片樣式 --- */
        .menu-card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px;
            display: flex; align-items: center; cursor: pointer;
            border: 1px solid #eee;
        }
        .menu-card:active { background-color: #f1f1f1; transform: scale(0.98); }
        .menu-icon { font-size: 1.5rem; color: #333; margin-right: 15px; width: 40px; text-align: center; }
        .menu-text h5 { margin: 0; font-size: 1.1rem; font-weight: 700; }
        .menu-text p { margin: 0; font-size: 0.85rem; color: #888; }
        
        /* --- 內容區塊 --- */
        .content-card {
            background: white; border-radius: 12px; padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03); margin-bottom: 15px;
        }
        
        /* --- 訂單與狀態 --- */
        .status-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        .bg-ok { background: #d4edda; color: #155724; }
        .bg-wait { background: #fff3cd; color: #856404; }
        .bg-err { background: #f8d7da; color: #721c24; }

        /* --- 返回按鈕 --- */
        .btn-back {
            border: none; background: #e9ecef; width: 40px; height: 40px; border-radius: 50%;
            display: inline-flex; align-items: center; justify-content: center; color: #333;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner-border text-dark loading-spinner" role="status"></div>
        <div class="loading-text">ORMKUB SYSTEM</div>
        <small class="text-muted mt-2" id="loading-msg">系統連線中...</small>
    </div>

    <div id="app" class="container py-4" style="max-width: 480px;">
        
        <div id="register-view" class="hidden">
            <div class="text-center mb-4">
                <img src="https://drive.google.com/uc?export=view&id=1UYSXoA5ZY1DJJZrsGzGysQFc-HeXcmeq" class="brand-logo" alt="Logo">
                <h4>歡迎加入 Ormkub</h4>
                <p class="text-muted">請填寫資料以啟用服務</p>
            </div>
            <div class="content-card">
                <form onsubmit="event.preventDefault(); doRegister();">
                    <div class="mb-3"><label class="form-label small">Email</label><input type="email" id="reg-email" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label small">群內名稱</label><input type="text" id="reg-name" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label small">收件人</label><input type="text" id="reg-receiver" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label small">手機</label><input type="tel" id="reg-phone" class="form-control" required></div>
                    <div class="mb-3"><label class="form-label small">7-11 門市</label><input type="text" id="reg-store" class="form-control" required></div>
                    <button class="btn btn-dark w-100 py-2 mt-2">綁定帳號</button>
                </form>
            </div>
        </div>

        <div id="home-view" class="hidden">
            <div class="text-center mb-5 mt-3">
                <img src="https://drive.google.com/uc?export=view&id=1UYSXoA5ZY1DJJZrsGzGysQFc-HeXcmeq" class="brand-logo" alt="Logo">
                <h3 class="fw-bold">Welcome</h3>
                <p class="text-muted">Hi, <span id="home-name">Member</span></p>
            </div>

            <div onclick="goToPage('markets')" class="menu-card">
                <div class="menu-icon"><i class="bi bi-shop"></i></div>
                <div class="menu-text">
                    <h5>專屬賣場</h5>
                    <p>瀏覽可下單商品</p>
                </div>
            </div>

            <div onclick="goToPage('orders')" class="menu-card">
                <div class="menu-icon"><i class="bi bi-receipt"></i></div>
                <div class="menu-text">
                    <h5>我的訂單</h5>
                    <p>查詢對帳與出貨狀態</p>
                </div>
            </div>

            <div onclick="goToPage('profile')" class="menu-card">
                <div class="menu-icon"><i class="bi bi-person-vcard"></i></div>
                <div class="menu-text">
                    <h5>會員資料</h5>
                    <p>查看個人檔案</p>
                </div>
            </div>

            <div class="text-center mt-5">
                <a href="https://ormkub.pse.is/LINEOA527" target="_blank" class="btn btn-outline-secondary btn-sm rounded-pill px-4">
                    <i class="bi bi-line me-1"></i> 聯絡客服
                </a>
            </div>
        </div>

        <div id="dashboard-view" class="hidden">
            <div class="d-flex align-items-center mb-3">
                <button class="btn-back" onclick="goBackHome()"><i class="bi bi-chevron-left"></i></button>
                <h5 class="ms-3 fw-bold mb-0" id="page-title">TITLE</h5>
            </div>

            <div id="page-markets" class="page-content hidden">
                <div id="market-list"></div>
            </div>

            <div id="page-orders" class="page-content hidden">
                <div id="orders-container"></div>
            </div>

            <div id="page-profile" class="page-content hidden">
                <div class="content-card">
                    <div class="mb-2 text-muted small">群內名稱</div>
                    <div class="fs-5 fw-bold mb-3" id="p-group">...</div>
                    <hr>
                    <div class="mb-2 text-muted small">基本資料</div>
                    <p class="mb-1"><strong>Email:</strong> <span id="p-email">...</span></p>
                    <p class="mb-1"><strong>手機:</strong> <span id="p-phone">...</span></p>
                    <p class="mb-1"><strong>收件人:</strong> <span id="p-receiver">...</span></p>
                    <p class="mb-0"><strong>門市:</strong> <span id="p-store">...</span></p>
                </div>
                <a href="https://ormkub.pse.is/LINEOA527" target="_blank" class="btn btn-success w-100 text-white">
                    <i class="bi bi-line"></i> 聯繫客服修改
                </a>
            </div>
        </div>

    </div>
